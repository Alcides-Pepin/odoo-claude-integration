name: Weekly Activity Reports

on:
  schedule:
    # Chaque lundi √† minuit UTC
    - cron: '0 0 * * 1'
  workflow_dispatch:  # Permet d√©clenchement manuel pour tests

jobs:
  generate-reports:
    runs-on: ubuntu-latest
    steps:
      - name: Generate weekly activity reports
        run: |
          echo "üöÄ Starting weekly activity reports generation..."

          response=$(curl -s -w "\n%{http_code}" https://api-server-production-22d0.up.railway.app/generate_weekly_activity_reports)
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')

          echo "HTTP Status: $http_code"
          echo "Response: $body"

          if [ "$http_code" -ne 200 ]; then
            echo "‚ùå Error: Endpoint returned $http_code"
            exit 1
          fi

          echo "‚úÖ Success: Reports generation started"
          echo "üìä Check Odoo project 151 for the generated reports"
          echo ""
          echo "Note: Reports are generated asynchronously in the background."
          echo "All 37 reports should appear in Odoo within the next hour."
